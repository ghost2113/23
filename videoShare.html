<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>视频分享详情页</title>
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/video-js.css" /> 
    <link rel="stylesheet" href="./css/newsShare.css" /> 
    	<style>
		.m {
			width: 100%;
			height: 200px;
			margin-left: auto;
			margin-right: auto;
		}
		</style>
</head>
<body>
	<div class="m">
      <video id="my-video" class="video-js myVideo" controls preload="auto" poster="" data-setup="{}" webkit-playsinline="true" playsinline="true">
        <source class="videoSrc" src="http://jq22com.qiniudn.com/jq22-sp.mp4" type="video/mp4">
        <p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
      </video>
      <script src="js/video.min.js"></script> 
      <script src="http://vjs.zencdn.net/5.19/lang/zh-CN.js"></script>
      <script type="text/javascript">
			var myPlayer = videojs('my-video');
			videojs("my-video").ready(function(){
				var myPlayer = this;
				/*myPlayer.play();*/				
			});
			  
		</script> 
    </div>
	<div class="videoCon">
		<p class="videoName">迪丽热巴《烈火如歌》如歌红衣娇俏惊艳 银雪白衣颠倒娇俏惊艳 银雪白衣颠倒娇俏惊艳 银雪白衣颠倒娇俏惊艳 银雪白衣颠倒</p>
		<div class="videoInfo">
			<span class="videoSource">优酷</span>
			<span class="playCnt">164</span>次播放
		</div>
	</div>
	<section id="main">				
		<div class="title"><span></span>相关推荐</div>
		<ul class="newsList">
			<a href="">
			<li class="items">
				<div class="leftCon">
					<p>vivo X21屏幕指纹手机发布 鹿晗邀你一起解锁vivoivo X21屏幕指纹手机发布 鹿晗邀你一起解锁viv</p>
					<div class="itemsInfor">
						<span>新华社</span>
						<span>刚刚</span>
						<span>18909</span>阅读
					</div>
				</div>
				<div class="rightImg">
					<img src="./img/userPhoto.jpg" alt="" />
				</div>
			</li>
			</a>
		</ul>
	</section>
	<div class="shareLink">
		<div class="icon"><span></span><span>头条TVD</span></div>		
		<span>看新闻赚零花钱</span>		
		<a id="openLink" href="#">打开</a>
	</div>	
</body>
	<script type="text/javascript" src="./js/rem.js"></script>
	<script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="./js/fastclick.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script type="text/javascript">		
			var videoUrl = window.location.href;
/*			videoUrl = 						
			"http://47.96.1.236:8080/zttH5/newsShare.html?appVersion=1.2.3&backdata=1&brand=apple&domain=http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0/&extdata=eyJzdHJhdGVneSI6IjIuNi4zMC44LmJ1dHdtM3Y3NWo4Mi45LjJ1ei4zLnZueXJyaC4uMS40Y3h4bmYzY3FramMiLCJjaGFubmVsX2lkIjoiMjQifQ==&height=667&idIdfa=C83B320E-16C2-4324-BEC9-C43C0238E410&idImei=xxxx&infoId=9q0KkXapK3ax&ip=183.156.227.161&model=iPhone&osType=2&osVersion=11.3&packageName=com.muki.TopLineTV&type=1&urls=video/list&userAgent=Mozilla/5.0%20(iPhone;%20CPU%20iPhone%20OS%2011_3%20like%20Mac%20OS%20X)%20AppleWebKit/605.1.15%20(KHTML,%20like%20Gecko)%20Mobile/15E216&userId=333&videoOsType=ios&width=375&****zlink=https://lkme.cc/GJD/kzeKlr1DK";*///ios
/*			videoUrl = 						
			"http://47.96.1.236:8080/zttH5/videoShare.html?appVersion=1.2.3&brand=apple&domain=http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0/&extdata=eyJzdHJhdGVneSI6IjIuNi4zMC44LmJ3ZDN3NDZhNHA0dS45LjNtLjIyLjFkeDhiY2suLjMwMC4xZ3ZjcGZiOTU3MTIiLCJjaGFubmVsX2lkIjoiMjQifQ==&height=1136&id=nrVDa7jOW77X&idImei=eefcebef9c3baffb&infoId=nrVDa7jOW77X&ip=192.168.0.124&model=iPhone6&osType=1&osVersion=1.1.2&packageName=com.muki.topline&page=1&type=1&urls=information/list&userAgent=&userId=331&videoOsType=android&width=640&z****zlink=https://lkme.cc/GJD/e53ZATnCK&z****znewsUrl=http://p0.qhimg.com/video/568_320_70/t0137e30ab7129c9902.webp&from=singlemessage";*///android
	
			var urlResult = decodeURI(videoUrl).split("****");
			var urlPara = urlResult[0].split("?")[1];
			/**
			 * 获取Url地址中userId参数   userID
			 */
			console.log("参数",urlPara);
			function getUrlParams(name) { 
			    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); //定义正则表达式 
			    var r = urlPara.substr(urlPara.indexOf("?")+1).match(reg);   
			    if (r != null) return unescape(r[2]); 
			    return null; 
			};
			
			/**
			 *   @param    
			 *   device:设备名称（0为安卓，1为iOS，2为PC）;
			     userId:用户ID;
			     packageName：app包名；
			     appVersion：app版本号；
			     idIdfa：ios为idfa;
			     idImei: android为imei;
			     height: 屏幕的物理高度，以像素为单位；
			     width：屏幕的物理宽度，以像素为单位；
			     brand：设备品牌；
			     model：设备型号；
			     osVersion：设备操作系统版本号，例如3.1.2，需要三位数；
			     osType: 操作系统类型 1.ANDROID 2.IOS 3.WP；
			     type: 设备网络环境 1.WIFI 2.UNKNOWN 3.2G 4.3G 5.4G；
			     ip: 设备当前ip；
			     domain：站点主域；
			     urls: 当前页面；
			     userAgent：浏览器的UA			     
			     link:深度链接
			 */
			var videoOsType = getUrlParams("videoOsType");
			var device = getUrlParams("device");
			var userId = getUrlParams("userId");
			var extdata = getUrlParams("extdata");
			var packageName = getUrlParams("packageName");
			var appVersion = getUrlParams("appVersion");
			var page = getUrlParams("page");
			var idIdfa = getUrlParams("idIdfa");
			var idImei = getUrlParams("idImei");
			var height = getUrlParams("height");
			var width = getUrlParams("width");
			var brand = getUrlParams("brand");
			var model = getUrlParams("model");
			var osVersion = getUrlParams("osVersion");
			var osType = getUrlParams("osType");
			var type = getUrlParams("type");
			var ip = getUrlParams("ip");
			var domain = getUrlParams("domain");
			var urls = getUrlParams("urls");
			var userAgent = navigator.userAgent;
			var id = getUrlParams("infoId");//详情
			device = 1;
			console.log({
				"userId":userId,
				"id":id,
			    "extdata":extdata,
			    "page":page,			     
			     "packageName":packageName,
			     "appVersion":appVersion,
			     "idIdfa":idIdfa,
			     "idImei": idImei, 
			     "height": height,
			     "width":width,
			     "brand":brand,
			     "model":model,
			     "osVersion":osVersion,
			     "osType": osType,
			     "type": type, 
			     "ip": ip,
			     "domain":domain,
			     "urls": urls,
			     "userAgent":userAgent,
			  });
		 	/**
		    * 视频链接
		    */
		   axios({	
			  url: '/infos/get',
			  method: 'get', // 默认是 get
			  baseURL: 'http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0/',
			  params: {
			     infoId:id		    
			  }
			  })
			.then(function(res){
				console.log("详情",res);
				//视频信息
				var item = res.data.data;
					$(".vjs-poster").css("background-image","url("+item.imgUrl+")");
					$(".vjs-tech").attr("src",item.url);
					$(".videoName").html(item.title);
					$(".videoSource").html(item.source);
					$(".playCnt").html(item.readCnt);
			 })
			.catch(function(error){
				console.log(error);
			});
			axios({	
			  url: '/video/related',
			  method: 'get', // 默认是 get
			  baseURL: 'http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0/',
			  params: {
			  	 userId:userId,
			     videoOsType:videoOsType,
			     id:id,
			     extdata:extdata,
			     page:1,
			     packageName:packageName,
			     appVersion:appVersion,
			     idIdfa:idIdfa,
			     idImei: idImei, 
			     height: height,
			     width:width,
			     brand:brand,
			     model:model,
			     osVersion:osVersion,//设备操作系统版本号，例如3.1.2，需要三位数；
			     osType: osType, //1.ANDROID 2.IOS 3.WP；
			     type: type, //1.WIFI 2.UNKNOWN 3.2G 4.3G 5.4G；
			     ip: ip,//设备当前ip；
			     domain:domain,//站点主域；
			     urls: urls,//当前页面；
			     userAgent:userAgent,//浏览器的UA
			  }
			  })
			.then(function(res){
				/*alert("appVersion",appVersion);*/
			  	console.log("相关视频",res);
			  	var _html = "";	
			  	console.log(res.data.data);
			  	res.data.data.forEach(function(item,index){
			  		var timeDiff = new Date() - new Date(item.obj.createDate).getTime();
			  		if(item.type==0){
			  			_html += 
			  			'<a href="'+ item.obj.url+'">'
							+'<li class="items">'
								+'<div class="leftCon">'
									+'<p>'+item.obj.title+'</p>'
									+'<div class="itemsInfor">'
										+'<span>'+item.obj.author+'</span>'
										+'<span>'+countdown(timeDiff)+'</span>'
										+'<span>'+item.obj.playCnt+'</span>阅读'
									+'</div>'
								+'</div>'
								+'<div class="rightImg">'
									+'<img src="'+item.obj.url+'" alt="" />'
								+'</div>'
							+'</li>'
						+'</a>';
			  		}else if(item.type == 2){
			  			console.log("广告",index);
			  			_html += 
			  			'<a href="'+ item.obj.cUrl+'">'
					  		+'<li class="items">'
								+'<div class="leftCon">'
									+'<p>'+item.obj.title+'</p>'
									+'<div class="itemsInfor">'
										+'<span>广告</span>'								
									+'</div>'
								+'</div>'
								+'<div class="rightImg">'
									+'<img src="'+item.obj.url+'" alt="" />'
								+'</div>'
							+'</li>'
						+'</a>';
			  		}					
			  	})		
			  	console.log("_html渲染内容",_html);
			  	//渲染相关推荐
			  	$(".newsList").eq(0).html(_html);
			 })
			.catch(function(error){
				console.log(error);
			});
			/**
			 * 时间计时
			 */
			function countdown(leftTime){				
				var d,h,m,s; 
				var showTime;
                if(leftTime>=0){  
	                 d = Math.floor(leftTime/1000/60/60/24);  
	                 h = Math.floor(leftTime/1000/60/60%24);  
	                 m = Math.floor(leftTime/1000/60%60);  
	                 s = Math.floor(leftTime/1000%60);                     
	            }  
/*	            //将倒计时赋值到div中  				
				console.log(`${h}:${m}:${s}`);*/
				if(m!=0&&h===0){
					if(m=="undefiend"){showTime = "刚刚";}
					showTime = m+"分钟前";
				}else if(m===0){
					if(s=="undefiend"){showTime = "刚刚";}
					showTime = s+"秒前";
				}else if(h!=0){	
					if(h=="undefiend"){showTime = "刚刚";}
					showTime = h+"小时前";
				}
				return showTime;
				/*console.log(showTime);*/
			};
			
	</script>
	<script src="https://static.lkme.cc/linkedme.min.js" ></script>
	<script type="text/javascript">
      linkedme.init("235d6842193c1bfb34204dd2ee7a3585", {type:"live"}, null);
      var data = {};
      data.type = "live";  //表示现在使用线上模式,如果填写"test", 表示测试模式.【可选】
      data.feature = "功能名称"; // 自定义深度链接功能，多个用逗号分隔，【可选】
      data.stage = "阶段名称"; // 自定义深度链接阶段，多个用逗号分隔，【可选】
      data.channel = "渠道名称"; // 自定义深度链接渠道，多个用逗号分隔，【可选】
      data.tags = "标签名称"; // 自定义深度链接标签，多个用逗号分隔，【可选】
      data.ios_custom_url = "http://www.pgyer.com/Headline"; // 自定义iOS平台下App的下载地址，如果是AppStore的下载地址可以不用填写，需填写http或https【可选】
      data.ios_direct_open = true; //未安装情况下，设置为true为直接打开ios_custom_url，默认为false【可选】
      data.android_custom_url = "http://47.96.1.236:8080/app-debug.apk";// 自定义安卓平台下App的下载地址，需填写http或https【可选】
      data.android_direct_open =true; //设置为true，所有情况下跳转android_custom_url，默认为false【可选】
      var value1 = 1;
      var value2 = 2;
      data.params = '{"key1":"'+value1+'","key2":"'+value2+'"}'; //注意单引号和双引号的位置
      linkedme.link(data, function(err, response){
        if(err){
          // 生成深度链接失败，返回错误对象err
        } else {
			/**
			 * 深度链接
			 */
			$("#openLink").attr("href",response.url);
        	/*document.body.innerHTML += '<a class="linkedme" href="'+response.url+'">LinkedME深度链接</a>'*/
        }
      },false);            
	</script>
</html>
</html>



