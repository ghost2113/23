<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>徒弟列表</title>
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/common.css" />
    <link rel="stylesheet" href="./css/discList.css" />
        <link rel="stylesheet" href="./css/mescroll.min.css" />
    <script type="text/javascript">    	
   		document.addEventListener('plusready', function(){
   			//console.log("所有plus api都应该在此事件发生后调用，否则会出现plus is undefined。"   			
   		});   		
    </script>
</head>
<body>
	<!--背景图-->
	<!--<div class="actiBg"><img src="./img/nfNewsBg.png" alt="" /></div>-->
	<section id="main">		
		<div class="banner">
			<img src="./img/disListText1.png" alt="" />
			<div class="getDisc">
				<button onclick="disciple()">收徒赚大钱</button>
			</div>
			<span class="rules">活动规则</span>
		</div>
		<div class="discCon">
			<ul class="discTab">
				<li>我的徒弟<span></span></li>
				<li>有效徒弟<span></span></li>
				<li>唤醒徒弟<span></span></li>
			</ul>
			<div class="discList mescroll" id="discList">
				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>
								<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>
								<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="myDisc">
						尚未成为有效徒弟
					</div>
				</li>
			</div>	
<!--			<div class="discList">
				<li>
					<div class="availDisc">
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div>
						累计进贡<span class="redFont">110</span>
					</div>
				</li>			
			</div>	
			<div class="discList">
				<li>
					<div>
						<span class="userPhoto"><img src="img/userPhoto.jpg" alt="" /></span><span class="userName">昵称</span>
					</div>
					<div class="wakeDisc">
						<button>唤醒</button>
					</div>
				</li>				
			</div>	-->
			
		</div>

	</section>
	<div class="mask" style="display:none;">
		<div class="discRules">
			<div class="discRulesTit">
				活动规则
				<span class="close"></span>
			</div>
			<div class="discRulesCont">
				<p>每收一位有效徒弟奖励一次性奖励<span class="redFont">3000金币</span> 每当徒弟阅读新闻获得<span class="redFont">10金币</span>，师傅将会获得双倍奖励</p>
				<p><strong>新增徒弟：</strong>朋友通过你分享的链接下载早头条并登陆 </p>
				<p><strong>有效徒弟：</strong>徒弟进贡<span class="redFont">100金币</span>时，成为你的有效徒弟</p>
				<ul>
					<h4  class="redFont">段位规则</h4>
					<li><span>青铜</span><span class="redFont">1</span>位有效徒弟</li>
					<li><span>白银：</span><span class="redFont">3</span>位有效徒弟</li>
					<li><span>黄金：</span><span class="redFont">10</span>位有效徒弟</li>
					<li><span>白金：</span><span class="redFont">66</span>位有效徒弟</li>
					<li><span>钻石：</span><span class="redFont">200</span>位有效徒弟</li>
					<li><span>大师：</span><span class="redFont">400</span>位有效徒弟</li>
					<li><span>王者：</span><span class="redFont">1000</span>位有效徒弟</li>
				</ul>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="./js/rem.js"></script>
	<script type="text/javascript" src="./js/zepto.js"></script>
	<script type="text/javascript" src="js/fastclick.js"></script>
	<script type="text/javascript">

			//获取Url地址中userId参数
			function getUrlParams(name) { 
			    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); //定义正则表达式 
			    var r = window.location.search.substr(1).match(reg);  
			    if (r != null) return unescape(r[2]); 
			    return null; 
			};
			var userID = getUrlParams("userId");//用户userId
			console.log("用户userId",userID);
			var type = "avaken";//定义请求类型;
			var _html = '';//渲染模板
			var page=1;//加载页数;
			var listHeight = $(".discList").height();//列表固定高度
			var listScrollTop = listHeight;
			//规则活动弹出层
			$(".rules").on("click",function(){
				$(".mask").show();
			});
			$(".close").on("click",function(){
				$(".mask").hide();
			});
			//选项卡
			$(".discTab li").on("click",function(){
				_html = "";
				
				listScrollTop = listHeight;
				var index = $(this).index();
				type = ["my","effective","avaken"][index];
				$(this).find("span").show();
				$(this).siblings().find("span").hide();
				$(this).addClass("active").siblings().removeClass("active");
				/*$(".discList").eq(index).show().siblings(".discList").hide();*/
				updataLoad(userID,type,1);				
			});
			//数据请求和渲染
			function updataLoad(userID,type,numPage){	
				numPage++;
				$.ajax({
					url:"http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0/apprentice/list?userId="+userID+"&type="+type+"&pageNo="+numPage+"&pageSize=5",
					type:"get",
					dataType:"json",
					async:false,
					success:function(res){
						console.log("http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0/apprentice/list?userId="+userID+"&type="+type+"&pageNo="+numPage+"&pageSize=1");
						console.log(res);
						res.data.forEach(function(item,index){
							/*console.log({"type":type,"item":item});*/
							switch(type){
								case "effective":
									_html+= 
									'<li>'
										+'<div class="availDisc">'
											+'<span class="userPhoto"><img src=\"'+item.headPath+'\" alt="" /></span><span class="userName">'+(item.nickName?item.nickName:"么有")+'</span>'
										+'</div>'
										+'<div>'
											+'累计进贡<span class="redFont">'+item.sumGold+'</span>'
										+'</div>'
									+'</li>';
									break;
								case "my":
									_html += 
									'<li>'
										+'<div>'
											+'<span class="userPhoto"><img src=\"'+item.headPath+'\" alt="" /></span><span class="userName">'+(item.nickName?item.nickName:"么有")+'</span>'
										+'</div>'
										+'<div class="myDisc">'
											+'尚未成为有效徒弟'
										+'</div>'
									+'</li>';
									break;
								case "avaken":
								_html += 
									'<li>'
										+'<div>'
											+'<span class="userPhoto"><img src=\"'+item.headPath+'\" alt="" /></span><span class="userName">'+(item.nickName?item.nickName:"么有")+'</span>'
										+'</div>'
										+'<div class="wakeDisc">'
											+'<button onclick="wake()">唤醒</button>'
										+'</div>'
									+'</li>';	
									break;
								default:
									break;
							}
							
						})
						$("#discList").html(_html);
						console.log({"listHeight":listHeight,"scrollTop":$(".discList").scrollTop(),"正在更新数据":"正在更新数据"});
						listScrollTop = $(".discList").scrollTop()+listHeight+50;						
					},
					error:function(error){
						console.log(error);
					}
				})	
			}				
			$(".discTab li").eq(0).trigger("click");		
			//上拉加载
			$(".discList").scroll(function(){
				var scrollTop = $(".discList").scrollTop();
				/*console.log({"listHeight":listHeight,"listScrollTop":listScrollTop,"scrollTop":scrollTop});*/
				if(listScrollTop<(listHeight+scrollTop)){
					console.log("正在更新。。。。。。");
					console.log(type);
					updataLoad(userID,type,page);
				}
			})
			//唤醒徒弟
			function wake(){    
		       var u = navigator.userAgent;
		       var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
		       var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
		       if(isAndroid){
		            alert('是否是Android：'+isAndroid);
		           window.jsi.wake("ok")
		       }else if(isiOS){
		            alert('是否是iOS：'+isiOS);
		           window.webkit.messageHandlers.wake.postMessage("ok");
		       }
			}
			//收徒赚大钱
			function disciple(){    
		       var u = navigator.userAgent;
		       var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
		       var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
		       if(isAndroid){
		            alert('是否是Android：'+isAndroid);
		           window.jsi.disciple("ok")
		       }else if(isiOS){
		            alert('是否是iOS：'+isiOS);
		           window.webkit.messageHandlers.disciple.postMessage("ok");
		       }		       	  
			}	
	</script>
</body>
</html>