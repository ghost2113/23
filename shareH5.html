<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>H5分享页面</title>
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/common.css" />
    <link rel="stylesheet" href="./css/shareH5.css" />
    <script type="text/javascript">    	
   		document.addEventListener('plusready', function(){
   			//console.log("所有plus api都应该在此事件发生后调用，否则会出现plus is undefined。"   			
   		});   		
    </script>
</head>
<body>
	<!--背景图-->
	<section id="main">	
		<div class="notice">
			<div class="user">				
			</div>
			<div class="userName"></div>
			<div class="getMoney">微信提现<span>100</span>元</div> 
			<div class="time"><span>10分钟</span>前</div>
		</div>
		<div class="shareTit"><img src="./img/shareTit.png" alt="" /></div>
		<div class="openPacket">
			<div class="packetNum"></div>
			<div class="prompt">
				<p>春风十年不如红包送你</p>
				<p>下载抢先领取5元现金</p>
			</div>
			<button></button>
		</div>
	</section>
	<script type="text/javascript" src="./js/rem.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script type="text/javascript" src="./js/zepto.js"></script>
	<script type="text/javascript" src="./js/fastclick.js"></script>
	<script>				
		$(function(){
			/**
			 * 获取Url地址中userId参数   userID
			 */
			function getUrlParams(name) { 
			    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); //定义正则表达式 
			    var r = window.location.search.substr(1).match(reg);  
			    if (r != null) return unescape(r[2]); 
			    return null; 
			};
			/**
			 * 定义变量   		
			 */
			var userID = getUrlParams("userId");			
			var _handle = true;//是否可以开启宝箱
			var nextOpen;
			axios.get("http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0//open/treasure?userId="+userID+"&isSubmit=0")
				.then(function(response){
					console.log(response);
					console.log({"现在时间":timestampToTime(response.data.leadTime.now),"下次开启时间":timestampToTime(response.data.leadTime.nextOpen),"创建时间":timestampToTime(response.data.leadTime.createDate)});	
					nextOpen = response.data.leadTime.nextOpen;
					//开启宝箱获取金币数
					$(".getGold").text(response.data.getGold);
					if(response.data.msg=="可以开宝箱"){
						$(".open").show();$(".countdown").hide();
						$(".getGold").text(response.data.getGold);
					}else{
						$(".open").hide();$(".countdown").show();						
					}
				})
			   .catch(function(error){
			   		console.log(error);
			 })
			/*   var count=8;*/
		    var countTime = setInterval(function(){
		   	console.log(1111);
/*		   	count++;*/
						var leftTime = nextOpen - new Date();
						var d,h,m,s;  
		                 if(leftTime>=0){  
			                 d = Math.floor(leftTime/1000/60/60/24);  
			                 h = Math.floor(leftTime/1000/60/60%24);  
			                 m = Math.floor(leftTime/1000/60%60);  
			                 s = Math.floor(leftTime/1000%60);                     
			            }  
			            //将倒计时赋值到div中  				
			            document.getElementById("_h").innerHTML = h+"时";  
			            document.getElementById("_m").innerHTML = m+"分";  
			            document.getElementById("_s").innerHTML = s+"秒"; 	
/*			            if(count==13){
			            	clearInterval(countTime);
			            	$(".open").show();$(".countdown").hide();
			            }*/
			},1000)						
			$(".open").on("click",function(){
				axios.get("http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0//open/treasure?userId=1&isSubmit=1")
				.then(function(response){
					console.log(response);
					countTime();
				})
			   .catch(function(error){
			   		console.log(error);
			   })
				/*$.ajax({
		    		url:"http://47.96.1.236:8080/zaotoutiao-api-home-1.0.0//open/treasure?userId=1&isSubmit=0",
					type:"get",
					dataType:"json",
					async:true,
					success:function(res){
						console.log("宝箱信息",res);
					},
					error:function(error){
						console.log(error);
					}
		    	});*/
				$(".mask").show();
			});

			//时间戳转日期
			function timestampToTime(timestamp) {
				console.log(timestamp);
		        var date = new Date(parseInt(timestamp));//时间戳为10位需*1000，时间戳为13位的话不需乘1000
		        Y = date.getFullYear() + '-';
		        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
		        D = date.getDate() + ' ';
		        h = date.getHours() + ':';
		        m = date.getMinutes() + ':';
		        s = date.getSeconds();
		        return Y+M+D+h+m+s;
		    }
			//获取倒计时时间
			function countTime(leftTime){
				var d,h,m,s;  
                 if(leftTime>=0){  
	                 d = Math.floor(leftTime/1000/60/60/24);  
	                 h = Math.floor(leftTime/1000/60/60%24);  
	                 m = Math.floor(leftTime/1000/60%60);  
	                 s = Math.floor(leftTime/1000%60);                     
	            }  
	            //将倒计时赋值到div中  
	
	            document.getElementById("_h").innerHTML = h+"时";  
	            document.getElementById("_m").innerHTML = m+"分";  
	            document.getElementById("_s").innerHTML = s+"秒"; 
			}
			//关闭弹出层
			$(".close").on("click",function(){
				$(".mask").hide();
			})
		})
	</script>
</body>
</html>